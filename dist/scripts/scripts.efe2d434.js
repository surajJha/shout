"use strict";angular.module("shoutApp",["ngAnimate","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch","ui.router","ui.utils","angularFileUpload","ui.bootstrap","ui.map","angucomplete"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/login"),a.state("admin",{url:"/admin",views:{"":{templateUrl:"views/admin.html"},"content@admin":{url:"",templateUrl:"views/partials/adminViewEvent.html"}}}).state("admin.add",{url:"/add",templateUrl:"views/partials/adminAddEvent.html",controller:"adminAddEventController"}).state("admin.view",{url:"/view",templateUrl:"views/partials/adminViewEvent.html",controller:"adminViewEventController"}).state("login",{url:"/login",templateUrl:"views/login.html",controller:"loginController"})}]).run(["$route","$state","$stateParams","$rootScope","$location","sessionService",function(a,b,c,d){d.baseUrl="http://localhost:80/shout",d.$on("$stateChangeSuccess",function(){!(b.is("admin")||b.is("admin.add")||b.is("admin.view"))||""!=sessionStorage.getItem("user")&&0!=sessionStorage.getItem("user")&&null!=sessionStorage.getItem("user")||b.go("login")})}]),angular.module("shoutApp").directive("header",function(){return{template:"<div></div>",restrict:"E",link:function(a,b){b.text("this is the header directive")}}}),angular.module("shoutApp").factory("loginService",["$rootScope","$q","$http",function(a,b,c){return{login:function(d){var e=b.defer();return c.post(a.baseUrl+"/server/login.php?func=login",d).success(function(a){e.resolve(a)}).error(function(a){e.reject(a)}),e.promise},logout:function(){var d=b.defer();return c.get(a.baseUrl+"/server/login.php?func=logout").success(function(a){d.resolve(a)}).error(function(a){d.reject(a)}),d.promise}}}]),angular.module("shoutApp").factory("sessionService",function(){return{set:function(a,b){return sessionStorage.setItem(a,b)},get:function(a){return sessionStorage.getItem(a)},destroy:function(a){return sessionStorage.removeItem(a)}}}),angular.module("shoutApp").factory("adminTaskFactory",["$http","$q","$rootScope",function(a,b,c){var d={};return d.getAllEvents=function(){var d=b.defer();return a.get(c.baseUrl+"/server/adminController.php?func=getAllEvents").success(function(a){d.resolve(a)}).error(function(a){d.reject(a)}),d.promise},d.addNewEvent=function(d){var e=b.defer();return a.post(c.baseUrl+"/server/adminController.php?func=addEvent",d).success(function(a){e.resolve(a)}).error(function(a){e.reject(a)}),e.promise},d.loadImages=function(d){var e=b.defer();return a.get(c.baseUrl+"/server/resize.php?imgpath="+d).success(function(a){e.resolve(a)}).error(function(a){e.reject(a)}),e.promise},d.getEventCategory=function(){var d=b.defer();return a.get(c.baseUrl+"/server/adminController.php?func=getEventCategory").success(function(a){d.resolve(a.data)}).error(function(a){d.reject(a)}),d.promise},d.getEventCity=function(){var d=b.defer();return a.get(c.baseUrl+"/server/adminController.php?func=getEventCity").success(function(a){d.resolve(a.data)}).error(function(a){d.reject(a)}),d.promise},d.getEventArea=function(d){var e=b.defer();return a.get(c.baseUrl+"/server/adminController.php?func=getEventArea&city="+d).success(function(a){e.resolve(a.data)}).error(function(a){e.reject(a)}),e.promise},d.updateEventDetails=function(d){var e=b.defer();return a.post(c.baseUrl+"/server/adminController.php?func=updateEventDetails",d).success(function(a){e.resolve(a)}).error(function(a){e.reject(a)}),e.promise},d.deleteEvent=function(d){var e=b.defer();return a.get(c.baseUrl+"/server/adminController.php?func=deleteEvent&event_detail_id="+d).success(function(a){e.resolve(a),console.log(a)}).error(function(a){e.reject(a)}),e.promise},d}]),angular.module("shoutApp").controller("adminAddEventController",["$scope","$rootScope","$upload","adminTaskFactory","$timeout","$window",function(a,b,c,d,e,f){a.formData={},a.formData.organiser_id="",a.formData.event_name="",a.formData.event_category="",a.formData.event_cost="",a.formData.event_overview="",a.formData.hash1="",a.formData.hash2="",a.formData.hash3="",a.formData.venue_name="",a.formData.event_area="",a.formData.event_location="",a.formData.no_of_days="",a.formData.repeatEventCheckbox="",a.formData.no_of_weeks="",a.formData.no_of_months="",a.formData.repeatType="",a.formData.images=[],a.formData.datetime=[],a.event_categories=[],a.event_areas=[],a.event_areas_id=[],a.event_cities=[],a.selectedFile=[],a.isAnyFileInvalid=[!0,!1,!1],a.isAnyFileSizeInvalid=[!0,!1,!1],a.primaryImageNotSelected=!0,a.isAnyFileSelected=[!1,!1,!1],a.isAnyFileExceptPrimaryHasError=!1;var g=5e6;a.init=function(){d.getEventCategory().then(function(b){for(var c=0;c<b.length;c++)a.event_categories[c]=b[c][0]}),d.getEventCity().then(function(b){for(var c=0;c<b.length;c++)a.event_cities[c]=b[c][0]})},a.init(),a.getEventArea=function(b){a.event_areas=[],d.getEventArea(b).then(function(b){for(var c=0;c<b.length;c++)a.event_areas[c]=b[c]})};!function(){a.days=[1,2,3,4,5,6,7],a.day="",a.change=function(b){a.day=b}}();a.getDateTime=function(){for(var b=0;b<a.day;b++)a.formData.datetime.push({date:$("#dt-"+b).val(),starttime:$("#time1-"+b).html(),endtime:$("#time2-"+b).html()})},a.submitEventForm=function(){a.getDateTime(),d.addNewEvent(a.formData).then(function(b){"success"===b.status?(a.uploadImages(b.event_detail_id),angular.element("#form-submit-message-placeholder").empty(),angular.element("#form-submit-message-placeholder").append('<div id="form-submit-message" class="alert alert-success" style="text-align: center;">Event added successfully !! You can view this event in the View Events Tab.</div>'),e(function(){angular.element("#form-submit-message-placeholder").empty(),a.resetFormAndClearFormModelData()},3e3)):(angular.element("#form-submit-message-placeholder").empty(),angular.element("#form-submit-message-placeholder").append('<div id="form-submit-message" class="alert alert-danger" style="text-align: center;">There was some problem in saving the event data. Please try again or contact the administrator.</div>'),e(function(){angular.element("#form-submit-message-placeholder").empty()},3e3))})},a.uploadImages=function(d){for(var e=0;e<a.formData.images.length;e++){var f=0;0==e&&(f=1);var g=a.formData.images[e];c.upload({url:b.baseUrl+"/server/adminController.php?func=uploadImages&event_detail_id="+d+"&primary_image="+f,method:"POST",data:g,file:g}).progress(function(){}).success(function(){}).error(function(a){console.log(a.message)})}},a.fileChanged=function(b,c){a.isAnyFileSelected[c]=!0,a.selectedFile[c]=b[0].name,0==c&&(a.primaryImageNotSelected=!1),a.isAnyFileInvalid[c]="image/png"==b[0].type||"image/jpeg"==b[0].type?!1:!0,a.isAnyFileSizeInvalid[c]=b[0].size<g?!1:!0,a.isAnyFileExceptPrimaryHasError=a.isAnyFileInvalid[1]||a.isAnyFileInvalid[2]||a.isAnyFileSizeInvalid[1]||a.isAnyFileSizeInvalid[2]?!0:!1},a.resetFormAndClearFormModelData=function(){f.location.reload()}}]),angular.module("shoutApp").controller("adminViewEventController",["$scope","$rootScope","adminTaskFactory","$modal","$log","$window",function(a,b,c,d,e){a.formData={},a.formData.event_detail_id=[],a.formData.event_name=[],a.formData.event_category=[],a.formData.event_cost=[],a.formData.event_overview=[],a.formData.event_hashtags=[],a.formData.venue_name=[],a.formData.event_area=[],a.formData.event_city=[],a.formData.event_location=[],a.formData.image=[],a.formData.datetime=[],a.formData.result_length=[],a.formData.no_of_days=[],a.formData.event_organizer_id=[],a.encoded_image_path_array=[],a.init=function(){c.getAllEvents().then(function(b){var d=-1;if("There are no existing events. Please contact the administrator for further enquiry"!=b){a.makeArray(b);for(var e=0;e<b.length;e++){a.formData.event_detail_id[e]=b[e].event_detail_id,a.formData.event_name[e]=b[e].event_name,a.formData.event_category[e]=b[e].category_name,a.formData.event_cost[e]=b[e].event_cost,a.formData.event_overview[e]=b[e].event_overview,a.formData.event_hashtags[e]=b[e].event_hashtags,a.formData.venue_name[e]=b[e].venue_name,a.formData.event_area[e]=b[e].event_area,a.formData.event_city[e]=b[e].event_city,a.formData.event_location[e]=b[e].event_location,a.formData.event_organizer_id=b[e].event_organizer_id,a.formData.image[e]=b[e].image,a.formData.datetime[e]=b[e].datetime,a.formData.event_cost[e]=parseInt(a.formData.event_cost[e]);for(var f=0;f<a.formData.image[e].length;f++)1==a.formData.image[e][f].primary&&(d++,function(b,d){c.loadImages(a.formData.image[e][b].image_path).then(function(b){a.encoded_image_path_array[d]=b})}(f,d))}}})},a.init(),a.makeArray=function(b){for(var c=[],d=0;d<b.length;d++)c.push(d);a.formData.result_length=c},a.deleteEventNow=function(b){swal({title:"Are you sure?",text:"This Event will be permanently deleted!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel!",closeOnConfirm:!1,closeOnCancel:!1},function(d){d?c.deleteEvent(b).then(function(){swal("Deleted!","This Event has been deleted.","success"),a.init()}):swal("Cancelled","Phew! The Event wa not deleted","error")})},a.open=function(b,c,f){var g=d.open({templateUrl:"myModalContent.html",controller:"ModalInstanceCtrl",size:b,resolve:{id:function(){return f},formData:function(){return c}}});g.result.then(function(b){a.selected=b},function(){e.info("Modal dismissed at: "+new Date)})}}]).controller("ModalInstanceCtrl",["$scope","$modalInstance","id","formData","adminTaskFactory","$upload","$rootScope","$timeout","$window",function(a,b,c,d,e,f,g,h,i){a.updatedFormData=d,a.id=c,a.updatedFormData.datetime_edit=d.datetime,a.change_event_schedule_flag=!1,a.selectedArea=a.updatedFormData.event_area[c],a.selectedCity=a.updatedFormData.event_city[c],a.selectedCategory=a.updatedFormData.event_category[c],a.updatedFormData.image_encoded_path_array=[],a.isImageHidden=[],a.newly_selected_file=[],a.updated_date_time_array=[],a.day="",a.event_categories=[],a.event_cities=[],a.event_areas=[],a.event_image_id=[],a.image_path_to_be_deleted=[],a.isAnyUpdatedFileInvalid=[!1,!1,!1],a.isAnyUpdatedFileSizeInvalid=[!1,!1,!1],a.primaryUpdatedImageNotSelected=!0,a.isAnyUpdatedFileSelected=[!1,!1,!1],a.isAnyUpdatedFileExceptPrimaryHasError=!1;var j=5e6;a.modalFormData={},a.init=function(){e.getEventCategory().then(function(b){for(var c=0;c<b.length;c++)a.event_categories[c]=b[c][0]}),e.getEventCity().then(function(b){for(var c=0;c<b.length;c++)a.event_cities[c]=b[c][0]}),e.getEventArea(a.selectedCity).then(function(b){for(var c=0;c<b.length;c++)a.event_areas[c]=b[c]});for(var b=0;b<a.updatedFormData.image[c].length;b++)!function(b){e.loadImages(a.updatedFormData.image[c][b].image_path).then(function(c){a.updatedFormData.image_encoded_path_array[b]=c})}(b)},a.init(),a.getUpdatedEventArea=function(b){a.event_areas=[],e.getEventArea(b).then(function(b){for(var c=0;c<b.length;c++)a.event_areas[c]=b[c]})},a.getDateTime=function(){for(var b=0;b<a.day;b++)a.updated_date_time_array.push({date:$("#dt-"+b).val(),starttime:$("#time1-"+b).html(),endtime:$("#time2-"+b).html()})},a.handleSelectedFile=function(b,c,d,e){a.newly_selected_file[c]=b[0].name,a.isImageHidden[c]=!0,a.event_image_id[c]=d,a.image_path_to_be_deleted[c]=e,a.isAnyUpdatedFileSelected[c]=!0,0==c&&(a.primaryUpdatedImageNotSelected=!1),a.isAnyUpdatedFileInvalid[c]="image/png"==b[0].type||"image/jpeg"==b[0].type?!1:!0,a.isAnyUpdatedFileSizeInvalid[c]=b[0].size<j?!1:!0,a.isAnyUpdatedFileExceptPrimaryHasError=a.isAnyUpdatedFileInvalid[1]||a.isAnyUpdatedFileInvalid[2]||a.isAnyUpdatedFileSizeInvalid[1]||a.isAnyUpdatedFileSizeInvalid[2]?!0:!1},a.makeArrayForDays=function(){for(var b=[],d=0;d<a.updatedFormData.no_of_days[c];d++)b.push(d);a.countDays=b},a.makeArrayForDays(),a.cancel=function(){b.dismiss("cancel")},a.updateEventDetails=function(){a.modalFormData.event_detail_id=a.updatedFormData.event_detail_id[c],a.modalFormData.event_name=a.updatedFormData.event_name[c],a.modalFormData.event_category=a.selectedCategory,a.modalFormData.event_cost=a.updatedFormData.event_cost[c],a.modalFormData.event_overview=a.updatedFormData.event_overview[c],a.modalFormData.hash1=a.updatedFormData.event_hashtags[c][0],a.modalFormData.hash2=a.updatedFormData.event_hashtags[c][1],a.modalFormData.hash3=a.updatedFormData.event_hashtags[c][2],a.modalFormData.venue_name=a.updatedFormData.venue_name[c],a.modalFormData.event_area=a.selectedArea[0],a.modalFormData.event_location=a.updatedFormData.event_location[c],a.modalFormData.change_event_schedule_flag=a.change_event_schedule_flag,a.modalFormData.repeatEventCheckbox=a.updatedFormData.repeatEventCheckbox,a.modalFormData.no_of_weeks=a.updatedFormData.no_of_weeks,a.modalFormData.no_of_months=a.updatedFormData.no_of_months,a.modalFormData.repeatType=a.updatedFormData.repeatType,a.modalFormData.event_organizer_id=1,a.modalFormData.change_event_schedule_flag&&(a.getDateTime(),a.modalFormData.updated_date_time_array=a.updated_date_time_array),e.updateEventDetails(a.modalFormData).then(function(c){"success"===c.status?(a.uploadImages(),angular.element("#form-submit-message-placeholder").empty(),angular.element("#form-submit-message-placeholder").append('<div id="form-submit-message" class="alert alert-success" style="text-align: center;">Event Updated successfully !! You can view this event in the View Events Tab.</div>'),h(function(){angular.element("#form-submit-message-placeholder").empty(),b.close(a.id),a.resetFormAndClearFormModelData()},2e3)):(angular.element("#form-submit-message-placeholder").empty(),angular.element("#form-submit-message-placeholder").append('<div id="form-submit-message" class="alert alert-danger" style="text-align: center;">There was some problem in saving the event data. Please try again or contact the administrator.</div>'),h(function(){angular.element("#form-submit-message-placeholder").empty()},3e3))}),a.uploadImages=function(){for(var b=0;b<a.event_image_id.length;b++)if(void 0!=a.event_image_id[b]){var c=a.updatedFormData.images[b];console.log(a.image_path_to_be_deleted[b]),f.upload({url:g.baseUrl+"/server/adminController.php?func=uploadUpdatedImages&event_image_id="+a.event_image_id[b]+"&image_path_old="+a.image_path_to_be_deleted[b],method:"POST",data:c,file:c}).progress(function(a){console.log("progress: "+parseInt(100*a.loaded/a.total)+"% file :"+a.config.file.name)}).success(function(a,b,c,d){console.log("File "+d.file.name+" is  uploaded successfully. Response: "+a)}).error(function(a){console.log(a.message)})}},a.resetFormAndClearFormModelData=function(){i.location.reload()}}}]),angular.module("shoutApp").controller("loginController",["$scope","loginService","sessionService","$location","$state",function(a,b,c,d,e){a.user={},a.user.username="",a.user.password="",a.login=function(){b.login(a.user).then(function(a){"success"==a.message?(c.set("user",a.data),e.go("admin")):(console.log(a),e.go("login"))})},a.logout=function(){console.log("logout pressed"),b.logout().then(function(a){(a.message="success")&&(c.destroy("user"),e.go("login"))})}}]),angular.module("shoutApp").directive("mydatepicker",["$compile",function(a){return{transclude:"element",scope:{day:"="},link:function(b){b.$watch("day",function(c,d){if(c!==d){b.dt=[],b.today=function(){b.dt[0]=new Date},b.today(),b.disabled=function(a,b){return"day"===b&&(0===a.getDay()||6===a.getDay())},b.toggleMin=function(){b.minDate=b.minDate?null:new Date},b.toggleMin(),b.opened=[],b.open=function(a,c){a.preventDefault(),a.stopPropagation(),b.opened[c]=!0},b.dateOptions={formatYear:"yy",startingDay:1},b.formats=["dd-MMMM-yyyy","yyyy/MM/dd","dd.MM.yyyy","shortDate"],b.format=b.formats[1],b.starttime=0,new Date,b.endtime=new Date,b.hstep=1,b.mstep=15,b.ismeridian=!1,c=parseInt(c);for(var e=[],f=0;c>f;f++)e.push(f);b.items=e,angular.element(document.getElementById("datepicker-placeholder")).html("");var g='<div ng-repeat="i in items track by $index"><div class="row"><div class="col-md-6" style="margin-top: 34px;"><p class="input-group"> <input type="text" class="form-control" datepicker-popup="{{format}}" ng-model="formData.datetime.dt[\'{{$index}}\']" is-open="opened[\'dt-\'+$index]" min-date="minDate" max-date="\'2015-06-22\'" datepicker-options="dateOptions" date-disabled="disabled(date, mode)" ng-required="true" close-text="Close" id="dt-{{$index}}" /> <span class="input-group-btn"> <button type="button" class="btn btn-default" ng-click="open($event, \'dt-\'+$index)"><i class="glyphicon glyphicon-calendar"></i></button> </span> </p> </div><div class="col-md-3"><timepicker ng-model="starttime" hour-step="hstep" minute-step="mstep" show-meridian="ismeridian"></timepicker><div id="time1-{{$index}}" ng-hide="true">{{starttime | date:\'HH:mm\' }}</div></div><div class="col-md-3"><timepicker ng-model="endtime" hour-step="hstep" minute-step="mstep" show-meridian="ismeridian"></timepicker><div id="time2-{{$index}}" ng-hide="true">{{endtime | date:\'HH:mm\' }}</div></div></div></div>';angular.element(document.getElementById("datepicker-placeholder")).append(a(g)(b))}},!0)}}}]),angular.module("shoutApp").directive("eventwidget",["$rootScope",function(a){return{templateUrl:a.baseUrl+"/app/views/partials/eventwidget.html",restrict:"E",link:function(){}}}]);